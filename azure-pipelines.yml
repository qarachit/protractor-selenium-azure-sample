# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

variables:
  LT_USERNAME: 'robovipin'
  LT_ACCESS_KEY: 'bX3VZpiN4Tp7cLD7MTfoXqqOZK3q7Xov7UcSCwGQkzf1MEB6bI'

jobs:
  - job: 'A'
    steps:
      - task: NodeTool@0
        inputs:
          versionSpec: '10.x'
        displayName: 'Install Node.js'

  - job: 'B'
    dependsOn: 'A'
    steps:
      - script: |
          wget https://s3.amazonaws.com/lambda-tunnel/LT_Linux.zip
          sudo apt-get install unzip
          unzip LT_Linux.zip
          ./LT -user robovipin -key bX3VZpiN4Tp7cLD7MTfoXqqOZK3q7Xov7UcSCwGQkzf1MEB6bI
        displayName: 'Deploy Tunnel'

  - job: 'C'
    steps:
      - script: |
          npm install
          npm install -g protractor
          cd conf
          protractor local.conf.js
        displayName: 'Run Tests'